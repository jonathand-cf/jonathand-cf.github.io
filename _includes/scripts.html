{% if site.footer_scripts %}
  {% for script in site.footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% else %}
  <script src="{{ '/assets/js/main.min.js' | relative_url }}"></script>
{% endif %}

{% if site.search == true or page.layout == "search" %}
  {%- assign search_provider = site.search_provider | default: "lunr" -%}
  {%- case search_provider -%}
    {%- when "lunr" -%}
      {% include_cached search/lunr-search-scripts.html %}
    {%- when "google" -%}
      {% include_cached search/google-search-scripts.html %}
    {%- when "algolia" -%}
      {% include_cached search/algolia-search-scripts.html %}
  {%- endcase -%}
{% endif %}

{% include analytics.html %}
{% include /comments-providers/scripts.html %}

{% if site.after_footer_scripts %}
  {% for script in site.after_footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}

<script>
// Ensure external links open in a new tab (adds target and rel) â€” mirrors the explicit
// anchors you used in `os.md`. This runs client-side so we don't need to edit every post.
document.addEventListener('DOMContentLoaded', function () {
  var anchors = document.querySelectorAll('a[href^="http"]');
  anchors.forEach(function (a) {
    try {
      var url = new URL(a.href);
      if (url.host !== window.location.host) {
        // only set if not already present
        if (!a.hasAttribute('target')) a.setAttribute('target', '_blank');
        // ensure rel contains noopener noreferrer
        var rel = (a.getAttribute('rel') || '').split(/\s+/).filter(Boolean);
        if (rel.indexOf('noopener') === -1) rel.push('noopener');
        if (rel.indexOf('noreferrer') === -1) rel.push('noreferrer');
        a.setAttribute('rel', rel.join(' '));
      }
    } catch (e) {
      // ignore malformed URLs
    }
  });
});
</script>
